{{ define "main" }}
  <div class="content">
    <div class="image-and-article">
      {{ with $image := resources.GetMatch .Params.featured_image }}
      {{ $jpg := $image.Resize "1150x jpg q85 Lanczos" }}
      <div class="image">
        <img
          srcset="{{ $jpg.RelPermalink }}"
          src="{{ $image.RelPermalink }}"
          alt="{{ .Params.title }}"
          id="featured_image"
          style="aspect-ratio: {{ $image.Width }}/{{ $image.Height }};" />
      </div>
      {{ end }}
      <article>
        <div class="title">
          <h1>{{ .Title }}</h1>

          {{ $dateMachine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
          {{ $dateHuman := .Date | time.Format ":date_long" }}
          <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time>
        </div>
        {{ .Content }}
      </article>
    </div>
    <aside>
      {{- if .Params.sky_plot -}}
        {{- with resources.Get .Params.sky_plot -}}
          <img src="{{ . }}" />
        {{- end -}}
      {{- else if fileExists (path.Join (path.Dir .Page.File.Path) "sky-plot.jpg") }}
      <section id="sky-plot">
        <h3>Sky Plot</h3>
        <img src="sky-plot.jpg" />
      </section>
      {{- end -}}

      {{- if (or .Params.equipment (or .Params.framing .Params.environment)) -}}
      <section id="details">
        <h3>Details</h3>

        {{- if .Params.equipment -}}
        <div>
          <h4>Equipment</h4>
          {{- if .Params.equipment.camera -}}
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-camera" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />
              <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
            </svg>
            Camera: {{ .Params.equipment.camera }}
          </div>
          {{- end -}}
          {{- if .Params.equipment.filters -}}
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-color-filter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M13.58 13.79c.27 .68 .42 1.43 .42 2.21c0 1.77 -.77 3.37 -2 4.46a5.93 5.93 0 0 1 -4 1.54c-3.31 0 -6 -2.69 -6 -6c0 -2.76 1.88 -5.1 4.42 -5.79" />
              <path d="M17.58 10.21c2.54 .69 4.42 3.03 4.42 5.79c0 3.31 -2.69 6 -6 6a5.93 5.93 0 0 1 -4 -1.54" />
              <path d="M12 8m-6 0a6 6 0 1 0 12 0a6 6 0 1 0 -12 0" />
            </svg>
            Filters: {{ .Params.equipment.filters }}
          </div>
          {{- end -}}
          {{- if .Params.equipment.telescope -}}
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-telescope" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M6 21l6 -5l6 5" />
              <path d="M12 13v8" />
              <path d="M3.294 13.678l.166 .281c.52 .88 1.624 1.265 2.605 .91l14.242 -5.165a1.023 1.023 0 0 0 .565 -1.456l-2.62 -4.705a1.087 1.087 0 0 0 -1.447 -.42l-.056 .032l-12.694 7.618c-1.02 .613 -1.357 1.897 -.76 2.905z" />
              <path d="M14 5l3 5.5" />
            </svg>
            Telescope: {{ .Params.equipment.telescope }}
          </div>
          {{- end -}}
          {{- if .Params.equipment.lens -}}
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-aperture" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
              <path d="M3.6 15h10.55" />
              <path d="M6.551 4.938l3.26 10.034" />
              <path d="M17.032 4.636l-8.535 6.201" />
              <path d="M20.559 14.51l-8.535 -6.201" />
              <path d="M12.257 20.916l3.261 -10.034" />
            </svg>
            Lens: {{ .Params.equipment.lens }}
          </div>
          {{- end -}}
          {{- if .Params.equipment.mount -}}
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-anchor" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M12 9v12m-8 -8a8 8 0 0 0 16 0m1 0h-2m-14 0h-2" />
              <path d="M12 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
            </svg>
            Mount: {{ .Params.equipment.mount }}
          </div>
          {{- end -}}
        </div>
        {{- end -}}

        {{- if .Params.framing -}}
        <div>
          <h4>Framing</h4>
          {{- if .Params.framing.ra -}}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-world-longitude" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
                <path d="M11.5 3a11.2 11.2 0 0 0 0 18" />
                <path d="M12.5 3a11.2 11.2 0 0 1 0 18" />
                <path d="M12 3l0 18" />
              </svg>
              {{ partial "definition.html" (dict "term" "Right Ascension" "global" $) }}: {{ .Params.framing.ra }}
            </div>
          {{- end }}
          {{- if .Params.framing.dec -}}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-world-latitude" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
                <path d="M4.6 7l14.8 0" />
                <path d="M3 12l18 0" />
                <path d="M4.6 17l14.8 0" />
              </svg>
              {{ partial "definition.html" (dict "term" "Declination" "global" $) }}: {{ .Params.framing.dec }}
            </div>
          {{- end }}
          {{ if and (and .Params.framing.width .Params.framing.height) .Params.framing.pxscale }}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-aspect-ratio" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z" />
                <path d="M7 12v-3h3" />
                <path d="M17 12v3h-3" />
              </svg>
              Size: {{ .Params.framing.width }}x{{ .Params.framing.height }} ({{ .Params.framing.pxscale }})
            </div>
          {{- end }}
          {{ if .Params.framing.rot }}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5" />
                <path d="M5.63 7.16l0 .01" />
                <path d="M4.06 11l0 .01" />
                <path d="M4.63 15.1l0 .01" />
                <path d="M7.16 18.37l0 .01" />
                <path d="M11 19.94l0 .01" />
              </svg>
              Rotation: {{ .Params.framing.rot }} E of N
            </div>
          {{- end -}}
        </div>
        {{- end -}}

        {{- if .Params.environment -}}
        <div>
          <h4>Environment</h4>
          {{ if .Params.environment.location }}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-map-pin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z" />
              </svg>
              Location: {{ .Params.environment.location }}
            </div>
          {{- end -}}
          {{ if .Params.environment.bortle }}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-bulb" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7" />
                <path d="M9 16a5 5 0 1 1 6 0a3.5 3.5 0 0 0 -1 3a2 2 0 0 1 -4 0a3.5 3.5 0 0 0 -1 -3" />
                <path d="M9.7 17l4.6 0" />
              </svg>
              Light Pollution: {{ partial "definition.html" (dict "term" "Bortle" "global" $) }} {{ .Params.environment.bortle }}
            </div>
          {{- end -}}
          {{ if .Params.environment.moon }}
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2" />
                <path d="M19 11h2m-1 -1v2" />
              </svg>
              Moon Illumination: {{ .Params.environment.moon }}
            </div>
          {{- end -}}
        </div>
        {{- end -}}
        </section>
        {{- end -}}

        <section id="tags">
          {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
        </section>
    </aside>
  </div>
{{ end }}
